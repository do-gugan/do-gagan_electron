<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
        <link rel="stylesheet" href="style.css">
        <title></title>
     </head>
    <body>
        <div id="main">
            <div id="top">
                <div id="top-left">
                    <div id="player-box" draggable="true" id="drag"></div>
                    <div id="player-controls">
                        <button id="Btn_ScreenShot">üì∑</button>
                        <button id="Btn_JumpBackward" class="webdings">7</button>
                        <button id="Btn_PlayPause" class="calibri">‚ñ∂/II</button>
                        <button id="Btn_JumpForward" class="webdings">8</button>
                    </div>
                </div>
                <div id="top-right">
                    <div id="search-box">
                        <div id="search-box1"><span id="Lbl_Search" class="label"></span></div>
                        <div id="search-box2"><input id="Txt_Search" name="Txt_Search" type="text"></div>
                        <div id="search-box3"><button id="Btn_SearchClear"></button></div>
                    </div>
                    <div id="memolist-box"></div>
                    <div id="right-bottom">
                        <label for="Chk_ShowHideNewMemo"><input id="Chk_ShowHideNewMemo" name="ShowHideNewMemo" type="checkbox" onchange="toglleNewMemoBlock();" checked/><span id="Lbl_ShowHideNewMemo" class="label"></span><label>
                    </div>
                </div>
            </div>
            <div id="bottom">
                bottom
            </div>
        </div>
    </body>
    <script>
        //„Ç∞„É≠„Éº„Éê„É´„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
        let locale;
        let _; //„É≠„Éº„Ç´„É©„Ç§„Ç∫ÊñáÂ≠óÂàóÂèñÂæóÁî®


        // „É°„Ç§„É≥„Éó„É≠„Çª„Çπ„Åã„ÇâË®ÄË™ûÁí∞Â¢É„ÇíÂèñÂæó„Åó„ÄÅ„Éö„Éº„Ç∏„Å´ÂøÖË¶Å„Å™„ÉÜ„Ç≠„Çπ„Éà„ÇíË°®Á§∫
        //const i18n = window.requires.i18n;
        (async ()=>{
            //const locale = await window.requires.ipcRenderer.invoke('getConfig', 'locale');
            locale = await window.api.getConfig('locale');
            //const locale = 'en';
            _ = window.api;
            document.querySelector("#Lbl_Search").innerHTML = _.t('SEARCH',locale) + ":";
            document.querySelector("#Btn_SearchClear").textContent = _.t('CLEAR',locale);
            document.querySelector("#player-box").innerHTML = '<div id="placeholderWrapper"><div id="placeholderInPlayer">' + _.t('DROP_HERE',locale) + '</div></div>';
            document.querySelector("#Lbl_ShowHideNewMemo").innerHTML = _.t('NEW_MEMO_FIELD',locale);

            //ÂàùÊúü„Ç¶„Ç§„É≥„Éâ„Ç¶„Çø„Ç§„Éà„É´Ôºà„Éê„Éº„Ç∏„Éß„É≥Ë°®Á§∫Ôºâ
            document.title = _.t('APPNAME') + "3 Ver." + window.api.getAppVersion();
        })();

        //„É°„Ç§„É≥„Éó„É≠„Çª„Çπ„Åã„Çâ„ÅÆ„Éó„ÉÉ„Ç∑„É•„Åß„É°„Éá„Ç£„Ç¢„Éï„Ç°„Ç§„É´„ÇíÈñã„Åè
        window.api.openVideo((event, path)=>{
            const videotag = '<video id="player" autoplay controls><source src="' + path + '"></video>';
            document.querySelector("#player-box").innerHTML = videotag;
            //„Éï„Ç°„Ç§„É´Âêç„Çí„Ç¶„Ç§„É≥„Éâ„Ç¶„Çø„Ç§„Éà„É´„Å´
            changeWindowTitle(path);
        });
        window.api.openAudio((event, path)=>{
            const audiotag = '<audio id="player" autoplay controls><source src="' + path + '"></audio>';
            document.querySelector("#player-box").innerHTML = audiotag;
            changeWindowTitle(path);
        });

        async function changeWindowTitle(path) {
            const filename = path.substring(path.lastIndexOf('\\') + 1); //macOS„Å†„Å®„Å©„ÅÜ„Å™„ÇãÔºü
            document.title = _.t("APPNAME",locale) + "3 | " + filename;
        }
        
        /**
         * Êñ∞Ë¶è„É°„É¢Ê¨Ñ„ÅÆË°®Á§∫ÔºèÈùûË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà
        */
        const toglleNewMemoBlock = function () {
            const checkbox = document.querySelector("#Chk_ShowHideNewMemo");
            const bottom = document.querySelector("#bottom");

            if (checkbox.checked == true) {
                bottom.style.display = 'block';
                window.api.toggleNewMemoBlockMenu(true);
            } else {
                bottom.style.display = 'none';
                window.api.toggleNewMemoBlockMenu(false);
            }
        }

        /**
         * „É°„Ç§„É≥„Éó„É≠„Çª„Çπ„Åã„Çâ„ÅÆ„Éó„ÉÉ„Ç∑„É•„ÅßÊñ∞Ë¶è„É°„É¢Ê¨Ñ„ÅÆË°®Á§∫ÔºèÈùûË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà„ÄÅÁµêÊûú„Çíbool„ÅßËøî„Åô
        */
        window.api.toggleNewMemoBlockFromMenu((event, result)=>{
            const checkbox = document.querySelector("#Chk_ShowHideNewMemo");
            const bottom = document.querySelector("#bottom");

            if (bottom.style.display == 'none') {
                //ÈùûË°®Á§∫„Å†„Å£„Åü„ÇâË°®Á§∫
                bottom.style.display = 'block';
                checkbox.checked = true;
                return true;
            } else {
                //Ë°®Á§∫„Å†„Å£„Åü„ÇâÈùûË°®Á§∫
                bottom.style.display = 'none';
                checkbox.checked = false;
                return false;
            }


        });

        //„Éï„Ç°„Ç§„É´„ÅÆ„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„ÇíÂèó„Åë‰ªò„Åë„Çã
        //ÂèÇËÄÉÂÖÉ: https://archive.craftz.dog/blog.odoruinu.net/2016/09/01/get-files-via-drag-and-drop-from-desktop/index.html
        //Ê®ôÊ∫ñÂãï‰Ωú„Çí„Ç≠„É£„É≥„Çª„É´
        document.querySelector("#player-box").ondragover = document.ondrop = function (e) {
            e.preventDefault();
        }
        //dragEnter„Ç®„Éï„Çß„ÇØ„ÉàÈñãÂßã
        document.querySelector("#player-box").ondragenter = document.ondrop = function (e) {
            const ph = document.querySelector("#placeholderInPlayer");
            //Êó¢„Å´„É°„Éá„Ç£„Ç¢„Éï„Ç°„Ç§„É´„ÇíÈñã„ÅÑ„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØph„ÅåÊ∂àÊªÖ„Åó„Å¶„ÅÑ„Çã„ÅÆ„Åßundefined„Å´„Å™„Çã
            if (ph != undefined) {
                document.querySelector("#player-box").classList.add("dragging");
                //const locale = window.api.getConfig('locale'); //ÈùûÂêåÊúü„Åß„Å®„Çå„Å™„ÅÑ
                //ÂØæÂøúÂΩ¢Âºè
                const validTypes = [
                    'video/mp4',
                    'video/webm',
                    'video/ogg', //ogv
                    'audio/mpeg', //mp3
                    'audio/wav',
                    'audio/ogg'
                    ];           
                if (e.dataTransfer.items.length > 1) {
                    ph.innerText = _.t('DROP_ONLY_SINGLE_FILE',locale);
                } else if (!validTypes.includes(e.dataTransfer.items[0].type)) {
                    ph.innerHTML = _.t('INVALID_FILETYPE',locale);
                } else {
                    ph.innerHTML = _.t('DROP_AND_OPEN',locale);
                }
            }

        }
        //dragLeave„Åß„Ç®„Éï„Çß„ÇØ„Éà„ÇíËß£Èô§
        document.querySelector("#player-box").ondragleave = document.ondrop = function (e) {
            document.querySelector("#player-box").classList.remove("dragging");
            const ph = document.querySelector("#placeholderInPlayer");
            if (ph != undefined) {
                ph.innerHTML = window.api.t('DROP_HERE',locale);
            }

        }
        //„Éâ„É≠„ÉÉ„Éó„Åï„Çå„Åü„Éï„Ç°„Ç§„É´„ÇíÈñã„Åè
        document.body.addEventListener('drop', function (e) {
            //console.log('file dropped:', e.dataTransfer.files[0].path);
            window.api.openDroppedFile(e.dataTransfer.files[0].path);
        });



    </script>
</html>

